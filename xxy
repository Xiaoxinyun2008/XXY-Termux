# 1. å¼ºåˆ¶æ¸…ç†æ—§ç¯å¢ƒ (é˜²æ­¢æ®‹ç•™å¹²æ‰°)
rm -f $PREFIX/bin/xxy
rm -f $PREFIX/tmp/xxy_*

# 2. å†™å…¥æ–°ç‰ˆè„šæœ¬ (v34.0)
cat > $PREFIX/bin/xxy << 'INSTALL_EOF'
#!/data/data/com.termux/files/usr/bin/bash
# ==============================================================================
# PROJECT: XXY (Ultimate Edition v34.0)
# DATE: 2023-10-27
# AUTHOR: Xiaoxinyun2008 & Optimized AI
# ==============================================================================

# --- 0. å…¨å±€é…ç½®ä¸ç‰ˆæœ¬æ§åˆ¶ ---
export VERSION="v34.0"
export UPDATE_URL="https://raw.githubusercontent.com/Xiaoxinyun2008/XXY-Termux/main/xxy"
export PREFIX="/data/data/com.termux/files/usr"
export TMPDIR="$PREFIX/tmp"
export TERMUX_PKG_OPTS="-y -o Dpkg::Options::=--force-confnew" 

[ ! -d "$TMPDIR" ] && mkdir -p "$TMPDIR"

# é¢œè‰²å®šä¹‰
R=$(tput setaf 1); G=$(tput setaf 2); Y=$(tput setaf 3)
B=$(tput setaf 4); P=$(tput setaf 5); C=$(tput setaf 6)
W=$(tput setaf 7); NC=$(tput sgr0)

# å¼‚å¸¸æ•è·
cleanup() {
    tput cnorm
    stty echo
    rm -f "$TMPDIR"/xxy_* 2>/dev/null
}
trap cleanup EXIT INT TERM

# --- 1. æ ¸å¿ƒæ£€æµ‹æ¨¡å— (å°ç™½é€»è¾‘å¢å¼º) ---

# 1.1 ç‰ˆæœ¬æ›´æ–°æ£€æµ‹
check_update() {
    echo -ne "${B}Checking for updates...${NC}\r"
    # è®¾ç½®è¶…æ—¶æ—¶é—´ 3ç§’ï¼Œé˜²æ­¢æ— ç½‘ç»œå¡æ­»
    REMOTE_VER=$(curl -s --max-time 3 "$UPDATE_URL" | grep "export VERSION=" | cut -d'"' -f2)
    
    if [[ -n "$REMOTE_VER" ]] && [[ "$REMOTE_VER" != "$VERSION" ]]; then
        echo -e "\n${Y}âš ï¸  å‘ç°æ–°ç‰ˆæœ¬: $REMOTE_VER (å½“å‰: $VERSION)${NC}"
        echo -e "æ­£åœ¨è‡ªåŠ¨å‡çº§..."
        bash -c "$(curl -fsSL "$UPDATE_URL")"
        exit 0
    fi
}

# 1.2 ä¾èµ–å…¨é‡è‡ªæ£€ (å¸¦å¯è§†åŒ–)
check_dependencies() {
    clear
    echo -e "${C}=== XXY ç¯å¢ƒåˆå§‹åŒ– ===${NC}"
    
    # å®šä¹‰åŸºç¡€ä¾èµ– + GUI ä¾èµ– + ç¾åŒ–ä¾èµ–
    DEPS="proot-distro pulseaudio wget curl ncurses-utils grep sed awk fastfetch"
    # Termux:X11 éœ€è¦ç‰¹æ®Šæ£€æŸ¥
    X11_DEPS="x11-repo termux-x11-nightly"
    
    # æ£€æŸ¥ fastfetch æ˜¯å¦å®‰è£… (Feature 2)
    if ! command -v fastfetch &>/dev/null; then
        echo -e "${Y}âš¡ æ­£åœ¨å®‰è£… Fastfetch (ç¾åŒ–ç»„ä»¶)...${NC}"
        pkg install fastfetch $TERMUX_PKG_OPTS >/dev/null 2>&1
    fi

    # æ£€æŸ¥åŸºç¡€ä¾èµ–
    MISSING=""
    for dep in $DEPS; do
        if ! command -v $dep &>/dev/null; then MISSING="$MISSING $dep"; fi
    done

    # æ£€æŸ¥ X11
    if ! command -v termux-x11 &>/dev/null; then
        echo -e "${Y}ğŸ“¦ æ­£åœ¨åˆå§‹åŒ– X11 å›¾å½¢åº“ä»“åº“...${NC}"
        pkg install x11-repo $TERMUX_PKG_OPTS >/dev/null 2>&1
        MISSING="$MISSING termux-x11-nightly"
    fi

    if [ -n "$MISSING" ]; then
        echo -e "${P}ğŸ› ï¸  æ­£åœ¨å®‰è£…æ ¸å¿ƒç»„ä»¶ (è¯·ä¿æŒç½‘ç»œ)...${NC}"
        echo -e "ç¼ºå¤±: $MISSING"
        # ä½¿ç”¨é™é»˜ä½†å¼ºåˆ¶æ¨¡å¼å®‰è£…ï¼Œç¡®ä¿å°ç™½ä¸ä¼šè¢« dpkg é”å¡ä½
        pkg update -y >/dev/null 2>&1
        pkg install $MISSING $TERMUX_PKG_OPTS
        
        if [ $? -ne 0 ]; then
            echo -e "\n${R}âŒ ä¾èµ–å®‰è£…å¤±è´¥ï¼è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚${NC}"
            echo "å»ºè®®åˆ‡æ¢ Termux è½¯ä»¶æº (termux-change-repo)"
            exit 1
        fi
    fi
}

# --- 2. å®¹å™¨å·¥ä½œé€»è¾‘ ---

# å®šä¹‰å†…éƒ¨è„šæœ¬è·¯å¾„
WORKER_SCRIPT="$TMPDIR/xxy_worker_$$.sh"
INJECT_SCRIPT="$TMPDIR/xxy_inject_$$.sh"

# ç”Ÿæˆå®¹å™¨å†…æ‰§è¡Œè„šæœ¬
create_worker_script() {
    rm -f "$WORKER_SCRIPT"
    
    cat << 'EOF' > "$WORKER_SCRIPT"
#!/bin/sh
action=$1
is_debian=false
is_arch=false
is_alpine=false

# æ™ºèƒ½åˆ¤æ–­åŒ…ç®¡ç†å™¨
if command -v apt >/dev/null; then
    INSTALL="apt install -y"; UPDATE="apt update -y"
    is_debian=true
elif command -v pacman >/dev/null; then
    INSTALL="pacman -S --noconfirm"; UPDATE="pacman -Sy --noconfirm"
    is_arch=true
elif command -v apk >/dev/null; then
    INSTALL="apk add"; UPDATE="apk update"
    is_alpine=true
else
    echo "Unknown OS"; exit 1
fi

case "$action" in
  change_source)
    # æç®€æ¢æºé€»è¾‘ (Feature 3: å°ç™½ä¼˜åŒ–)
    if [ "$is_debian" = true ]; then
        sed -i 's/http:\/\/.*archive.ubuntu.com/http:\/\/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list 2>/dev/null
        sed -i 's/http:\/\/ports.ubuntu.com/http:\/\/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list 2>/dev/null
        sed -i 's/http:\/\/deb.debian.org/http:\/\/mirrors.ustc.edu.cn/g' /etc/apt/sources.list 2>/dev/null
    elif [ "$is_alpine" = true ]; then
        sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories
    fi
    $UPDATE
    ;;

  install_gui)
    if [ "$is_debian" = true ]; then
        DEBIAN_FRONTEND=noninteractive $INSTALL xfce4 xfce4-goodies dbus-x11 tigervnc-standalone-server
    elif [ "$is_arch" = true ]; then
        $INSTALL xfce4 dbus tigervnc
    elif [ "$is_alpine" = true ]; then
        $INSTALL xfce4 dbus-x11 tigervnc
    fi
    
    # å¼ºåˆ¶ä¿®å¤ VNC å¯†ç  (å°ç™½é™·é˜±ä¿®å¤)
    mkdir -p ~/.vnc
    echo "123456" | vncpasswd -f > ~/.vnc/passwd
    chmod 600 ~/.vnc/passwd
    ;;

  install_fastfetch)
    # å®¹å™¨å†…å®‰è£… fastfetch (Feature 2)
    $INSTALL fastfetch || $INSTALL neofetch
    # æ ‡è®°å®‰è£…äº†å“ªä¸ª
    if command -v fastfetch >/dev/null; then echo "fastfetch" > /tmp/fetch_bin
    elif command -v neofetch >/dev/null; then echo "neofetch" > /tmp/fetch_bin
    else echo "none" > /tmp/fetch_bin; fi
    ;;
    
  install_cn)
    if [ "$is_debian" = true ]; then
        DEBIAN_FRONTEND=noninteractive $INSTALL locales fonts-noto-cjk ttf-wqy-zenhei
        echo "zh_CN.UTF-8 UTF-8" > /etc/locale.gen && locale-gen
        echo "export LANG=zh_CN.UTF-8" > /etc/profile.d/xxy_lang.sh
    fi
    ;;
esac
EOF
    chmod 755 "$WORKER_SCRIPT"
}

# è·å–ç³»ç»Ÿåˆ—è¡¨ (ä¿®å¤ Bug 1: å»é™¤é¢œè‰²ä»£ç )
get_systems() {
    # ä½¿ç”¨ sed å»é™¤ ANSI é¢œè‰²ä»£ç ï¼Œç¡®ä¿ grep åŒ¹é…çº¯æ–‡æœ¬
    proot-distro list | sed 's/\x1b\[[0-9;]*m//g' | awk '
        /^Installed distributions:/ {flag=1; next}
        /^Supported distributions:/ {flag=0}
        flag && /\*/ {print $2}
    '
}

# åå°ä»»åŠ¡æ‰§è¡Œå™¨
run_task() {
    local sys=$1
    local cmd=$2
    local desc=$3
    # è·¯å¾„æ˜ å°„ä¿®å¤
    local inner_script="/tmp/$(basename "$WORKER_SCRIPT")"
    
    tput cup 18 0
    echo -ne "${Y}âš™ï¸  [$sys] $desc...${NC}"
    
    proot-distro login "$sys" --shared-tmp -- /bin/sh "$inner_script" "$cmd" >/dev/null 2>&1
    
    tput cup 18 0
    if [ $? -eq 0 ]; then
        echo -ne "${G}âœ… [$sys] $desc å®Œæˆ          ${NC}"
    else
        echo -ne "${R}âŒ [$sys] $desc å¤±è´¥ (æ£€æŸ¥ç½‘ç»œ) ${NC}"
    fi
}

# ç³»ç»Ÿé€‰æ‹©èœå•
select_menu() {
    mapfile -t SYS_ARRAY < <(get_systems)
    
    if [ ${#SYS_ARRAY[@]} -eq 0 ]; then
        echo -e "\n${R}âš ï¸  æœªæ£€æµ‹åˆ°å·²å®‰è£…çš„ç³»ç»Ÿï¼${NC}"
        echo "è¯·å…ˆæ‰§è¡Œ [2] å®‰è£…ç³»ç»Ÿ"
        read -n 1 -s -r -p "æŒ‰ä»»æ„é”®è¿”å›..."
        return 1
    fi

    for i in "${!SYS_ARRAY[@]}"; do
        echo -e "${G}$((i+1)).${NC} ${SYS_ARRAY[$i]}"
    done
    echo -e "${W}0.${NC} è¿”å›"
    
    tput cnorm; stty echo
    read -p "ğŸ‘‰ é€‰æ‹©ç³»ç»Ÿåºå·: " choice
    stty -echo; tput civis
    
    if [ "$choice" == "0" ] || [ -z "$choice" ]; then return 1; fi
    if [[ "$choice" =~ ^[0-9]+$ ]] && [ "$choice" -ge 1 ] && [ "$choice" -le "${#SYS_ARRAY[@]}" ]; then
        local selected="${SYS_ARRAY[$((choice-1))]}"
        # äºŒæ¬¡éªŒè¯ï¼Œé˜²æ­¢ç©ºå€¼
        if [ -z "$selected" ]; then return 1; fi
        echo "$selected"
        return 0
    else
        echo "è¾“å…¥æ— æ•ˆ"; return 1
    fi
}

# --- 3. åŠŸèƒ½å®ç° ---

# [F1] ç™»å½•ç³»ç»Ÿ (è‡ªåŠ¨æ³¨å…¥ fastfetch)
do_login() {
    clear; echo -e "${C}=== ç™»å½•ç³»ç»Ÿ ===${NC}"
    TARGET=$(select_menu) || return
    
    create_worker_script
    local inner_script="/tmp/$(basename "$WORKER_SCRIPT")"
    local inner_inject="/tmp/$(basename "$INJECT_SCRIPT")"
    
    echo -e "${B}æ­£åœ¨é…ç½®å¯åŠ¨ç¯å¢ƒ...${NC}"
    # 1. å°è¯•å®‰è£… fastfetch
    proot-distro login "$TARGET" --shared-tmp -- /bin/sh "$inner_script" "install_fastfetch" >/dev/null 2>&1
    
    # 2. æ³¨å…¥ .bashrc
    cat > "$INJECT_SCRIPT" << 'EOF'
RC=~/.bashrc
[ -f /etc/profile.d/xxy_lang.sh ] && . /etc/profile.d/xxy_lang.sh
if [ -f /tmp/fetch_bin ]; then
    TOOL=$(cat /tmp/fetch_bin)
    rm -f /tmp/fetch_bin
    # é˜²æ­¢é‡å¤æ³¨å…¥
    if [ "$TOOL" != "none" ] && ! grep -q "$TOOL" "$RC" 2>/dev/null; then
        echo "" >> "$RC"
        echo "clear" >> "$RC" # ç™»å½•æ¸…å±
        echo "$TOOL" >> "$RC" # æ˜¾ç¤ºä¿¡æ¯
    fi
fi
EOF
    proot-distro login "$TARGET" --shared-tmp -- /bin/sh "$inner_inject" >/dev/null 2>&1
    
    cleanup
    echo -e "${G}æ­£åœ¨è¿›å…¥ $TARGET...${NC}"
    proot-distro login "$TARGET"
    
    tput civis; stty -echo; draw_ui
}

# [F2] å®‰è£…ç³»ç»Ÿ (å°ç™½è‡ªåŠ¨ä¼˜åŒ–)
do_install() {
    clear; echo -e "${C}=== å®‰è£…ç³»ç»Ÿ (å°ç™½æ¨èç‰ˆ) ===${NC}"
    # åªç»™å°ç™½çœ‹æœ€ç¨³çš„
    DISTROS=("ubuntu" "debian" "archlinux" "alpine")
    for i in "${!DISTROS[@]}"; do echo -e "${W}$((i+1)).${NC} ${DISTROS[$i]}"; done
    echo -e "${W}0.${NC} è¿”å›"
    
    tput cnorm; stty echo
    read -p "ğŸ‘‰ é€‰æ‹©å‘è¡Œç‰ˆ: " idx
    stty -echo; tput civis
    
    if [ "$idx" == "0" ]; then return; fi
    if [[ "$idx" =~ ^[0-9]+$ ]] && [ "$idx" -ge 1 ] && [ "$idx" -le "${#DISTROS[@]}" ]; then
        TARGET=${DISTROS[$((idx-1))]}
        
        echo -e "\n${Y}ğŸš€ æ­£åœ¨ä¸‹è½½ $TARGET é•œåƒ...${NC}"
        echo -e "${GR}(å¦‚æœé•¿æ—¶é—´ä¸åŠ¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ)${NC}"
        tput cnorm
        
        if proot-distro install $TARGET; then
            tput civis
            create_worker_script
            # è‡ªåŠ¨åŒ–æµç¨‹
            run_task "$TARGET" "change_source" "è‡ªåŠ¨æ›´æ¢å›½å†…æº (åŠ é€Ÿ)"
            run_task "$TARGET" "install_cn" "é…ç½®ä¸­æ–‡ç¯å¢ƒ"
            run_task "$TARGET" "install_fastfetch" "é¢„è£…ç³»ç»Ÿä¿¡æ¯å·¥å…·"
            
            echo -e "\n${G}ğŸ‰ å®‰è£…æˆåŠŸï¼ç³»ç»Ÿå·²ä¼˜åŒ–å®Œæ¯•ã€‚${NC}"
            read -n 1 -s -r -p "æŒ‰ä»»æ„é”®ç»§ç»­..."
        else
            echo -e "\n${R}ğŸ’¥ å®‰è£…å¤±è´¥ã€‚å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ã€‚${NC}"
            read -n 1 -s -r -p "æŒ‰ä»»æ„é”®ç»§ç»­..."
        fi
    fi
}

# [F3] å¯åŠ¨ GUI (ä¿®å¤ Bug 3)
do_gui() {
    clear; echo -e "${C}=== å¯åŠ¨æ¡Œé¢ç¯å¢ƒ ===${NC}"
    TARGET=$(select_menu) || return
    
    create_worker_script
    
    # æ£€æµ‹æ¡Œé¢ç¯å¢ƒæ˜¯å¦å®‰è£…
    echo -ne "ğŸ” æ­£åœ¨æ£€æŸ¥æ¡Œé¢ç»„ä»¶...\r"
    if ! proot-distro login "$TARGET" -- bash -c "command -v startxfce4" >/dev/null 2>&1; then
        echo ""
        echo -e "${Y}âš ï¸  æœªæ£€æµ‹åˆ°æ¡Œé¢ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…...${NC}"
        run_task "$TARGET" "install_gui" "å®‰è£… XFCE4 æ¡Œé¢ (è€—æ—¶è¾ƒé•¿)"
    fi

    echo -e "\n${G}è¯·é€‰æ‹©æ˜¾ç¤ºæ¨¡å¼:${NC}"
    echo -e "1. Termux:X11 ${Y}(æ¨è/æµç•…/éœ€APP)${NC}"
    echo -e "2. VNC Viewer (é€šç”¨/å…¼å®¹æ€§å¥½)"
    echo -e "0. è¿”å›"
    
    tput cnorm; stty echo
    read -p "æ¨¡å¼: " m
    stty -echo; tput civis
    
    if [ "$m" == "1" ]; then
        # X11 å¼ºåŠ›æ¸…ç†
        pulseaudio --kill >/dev/null 2>&1
        pkill -f com.termux.x11 >/dev/null 2>&1
        rm -rf "$TMPDIR/.X11-unix" # å…³é”®ä¿®å¤
        
        # å¯åŠ¨ PulseAudio
        pulseaudio --start --load="module-native-protocol-tcp auth-ip-acl=127.0.0.1 auth-anonymous=1" --exit-idle-time=-1
        
        # å”¤é†’ APP
        am start --user 0 -n com.termux.x11/com.termux.x11.MainActivity >/dev/null 2>&1
        sleep 1
        termux-x11 :0 >/dev/null 2>&1 &
        
        # å¯åŠ¨å‘½ä»¤
        CMD="export DISPLAY=:0 PULSE_SERVER=127.0.0.1; dbus-launch --exit-with-session startxfce4"
        echo -e "${G}ğŸš€ æ­£åœ¨å¯åŠ¨ X11... è¯·åˆ‡æ¢åˆ° Termux:X11 APP${NC}"
        proot-distro login "$TARGET" --shared-tmp -- bash -c "$CMD"
        
    elif [ "$m" == "2" ]; then
        # VNC å¯åŠ¨
        echo -e "${Y}ğŸš€ æ­£åœ¨å¯åŠ¨ VNC Server...${NC}"
        # ä¿®å¤ï¼šæ¸…ç†é”æ–‡ä»¶ + æŒ‡å®šåˆ†è¾¨ç‡
        CMD="vncserver -kill :1 >/dev/null 2>&1; rm -rf /tmp/.X1-lock /tmp/.X11-unix/X1; vncserver :1 -geometry 1280x720"
        proot-distro login "$TARGET" -- bash -c "$CMD"
        
        echo -e "\n${G}=== VNC å°±ç»ª ===${NC}"
        echo -e "åœ°å€: ${W}127.0.0.1:5901${NC}"
        echo -e "å¯†ç : ${W}123456${NC} (å·²è‡ªåŠ¨è®¾ç½®)"
        read -n 1 -s -r -p "æŒ‰ä»»æ„é”®è¿”å›..."
    fi
}

# --- 4. UI ç»˜åˆ¶ (ä¿®å¤ Bug 2: ASCII æ’ç‰ˆ) ---

draw_ui() {
    clear
    # ä½¿ç”¨ cat è¾“å‡ºçº¯æ–‡æœ¬ï¼Œé˜²æ­¢ printf é”™ä½
    cat << EOF
${C}
â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— ${W}XXY Termux${C}
â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â• ${GR}${VERSION}${C}
 â•šâ–ˆâ–ˆâ–ˆâ•”â•  â•šâ–ˆâ–ˆâ–ˆâ•”â•  â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  ${W}Ultimate Edition${C}
 â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—   â•šâ–ˆâ–ˆâ•”â•   ${NC}
${GR}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}
${GR}â”‚${NC} ${W}1.${NC} ç™»å½•ç³»ç»Ÿ (Login)    ${GR}â”‚${NC} ${W}3.${NC} å¯åŠ¨æ¡Œé¢ (GUI)
${GR}â”‚${NC} ${W}2.${NC} å®‰è£…ç³»ç»Ÿ (Install)  ${GR}â”‚${NC} ${W}0.${NC} é€€å‡ºç¨‹åº (Exit)
${GR}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}
EOF
    
    # æ˜¾ç¤ºå®¿ä¸»æœºçš„ fastfetch æ¦‚è¦ (Feature 2: å¯é€‰ï¼Œè‹¥å·²å®‰è£…)
    if command -v fastfetch >/dev/null; then
        fastfetch --config structure:OS:Memory --logo none 2>/dev/null | sed 's/^/  /'
    fi
}

# --- ä¸»ç¨‹åºå¾ªç¯ ---

# åˆå§‹åŒ–
check_update       # F1: æ›´æ–°æ£€æµ‹
check_dependencies # åŸºç¡€ç¯å¢ƒæ£€æŸ¥
create_worker_script
tput civis
stty -echo
draw_ui

INPUT_BUF=""

while true; do
    tput cup 12 0
    echo -ne "${C}â¤ è¯·è¾“å…¥åºå·: ${W}${INPUT_BUF}_        ${NC}"

    read -t 0.05 -n 1 key
    if [[ $? -eq 0 ]]; then
        if [[ -z "$key" ]]; then
            if [[ -n "$INPUT_BUF" ]]; then
                case $INPUT_BUF in
                    1) do_login ;;
                    2) do_install ;;
                    3) do_gui ;;
                    0) exit 0 ;;
                esac
                tput civis; stty -echo; draw_ui; INPUT_BUF=""
            fi
        elif [[ "$key" == $'\x7f' || "$key" == $'\b' ]]; then
            INPUT_BUF="${INPUT_BUF%?}"
        elif [[ "$key" == $'\e' ]]; then
            read -t 0.01 -n 2
        else
            INPUT_BUF="$INPUT_BUF$key"
        fi
    fi
done
INSTALL_EOF

# 3. æƒé™ä¿®å¤ä¸å¯åŠ¨å¼•å¯¼
chmod 755 $PREFIX/bin/xxy
sed -i 's/\r$//' $PREFIX/bin/xxy

echo -e "\033[1;32mâœ… XXY v34.0 å®‰è£…å®Œæˆï¼\nä¾èµ–å·²è‡ªåŠ¨ä¿®å¤ï¼Œè¯·è¾“å…¥ xxy å¯åŠ¨ã€‚\033[0m"
# è‡ªåŠ¨è¿›å…¥ xxy
exec xxy
